<%# Reusable Human Evaluation Modal %>
<%# Parameters:
  - record: The record to evaluate (LlmResponse or PromptTestRun)
  - form_url: The URL to submit the form to
  - context: 'monitoring' or 'testing' (for styling)
%>

<%
  # Determine styling based on context
  if context == 'testing'
    header_bg = '#DBEAFE'  # Blue for testing
    header_border = '#3B82F6'
    btn_class = 'btn-primary'
  else
    header_bg = '#D1FAE5'  # Green for monitoring
    header_border = '#10B981'
    btn_class = 'btn-success'
  end
%>

<div class="modal fade"
     id="human-evaluation-modal-<%= record.id %>"
     tabindex="-1"
     aria-labelledby="humanEvaluationModalLabel-<%= record.id %>"
     aria-hidden="true"
     data-controller="modal-fix"
     data-modal-fix-target="modal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header" style="background-color: <%= header_bg %>; border-bottom: 2px solid <%= header_border %>;">
        <h5 class="modal-title" id="humanEvaluationModalLabel-<%= record.id %>">
          <i class="bi bi-person-check"></i> Add Human Evaluation
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <%= form_with model: PromptTracker::HumanEvaluation.new,
                    url: form_url,
                    method: :post do |f| %>
        <div class="modal-body">
          <div class="mb-3">
            <p class="text-muted small">
              <strong>Record ID:</strong> #<%= record.id %><br>
              <strong>Created:</strong> <%= record.created_at.strftime("%Y-%m-%d %H:%M:%S") %>
            </p>
          </div>

          <div class="mb-3">
            <%= f.label :score, "Score (0-100)", class: "form-label" %>
            <%= f.number_field :score,
                               class: "form-control",
                               min: 0,
                               max: 100,
                               step: 1,
                               required: true,
                               placeholder: "Enter score between 0 and 100" %>
            <div class="form-text">
              How would you rate this <%= record.class.name.demodulize.underscore.humanize.downcase %>? (0 = Poor, 100 = Excellent)
            </div>
          </div>

          <div class="mb-3">
            <%= f.label :feedback, "Feedback", class: "form-label" %>
            <%= f.text_area :feedback,
                            class: "form-control",
                            rows: 4,
                            required: true,
                            placeholder: "Provide detailed feedback..." %>
            <div class="form-text">
              Explain your rating and provide constructive feedback.
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <%= f.submit "Submit Evaluation", class: "btn #{btn_class}" %>
        </div>
      <% end %>
    </div>
  </div>
</div>
