<div class="card mb-4">
  <div class="card-header <%= evaluation.passed? ? 'bg-success' : 'bg-danger' %> text-white">
    <h5 class="mb-0">
      <i class="bi bi-robot"></i> 
      LLM Judge Evaluation: 
      <% if evaluation.passed? %>
        <span class="badge bg-light text-success">PASSED</span>
      <% else %>
        <span class="badge bg-light text-danger">FAILED</span>
      <% end %>
    </h5>
  </div>
  <div class="card-body">
    <% metadata = evaluation.metadata || {} %>
    <% criteria_scores = metadata['criteria_scores'] || {} %>
    <% criteria = metadata['criteria'] || [] %>
    
    <div class="row mb-3">
      <div class="col-md-6">
        <p class="mb-1"><strong>Judge Model:</strong></p>
        <code><%= metadata['judge_model'] || 'Unknown' %></code>
        <% if metadata['mock_mode'] %>
          <span class="badge bg-warning text-dark ms-2">MOCK MODE</span>
        <% end %>
      </div>
      <div class="col-md-6">
        <p class="mb-1"><strong>Overall Score:</strong></p>
        <div class="d-flex align-items-center">
          <div class="progress flex-grow-1 me-2" style="height: 25px;">
            <% score_min = evaluation.score_min || 0 %>
            <% score_max = evaluation.score_max || 5 %>
            <% percentage = ((evaluation.score - score_min) / (score_max - score_min) * 100).round %>
            <div class="progress-bar <%= evaluation.passed? ? 'bg-success' : 'bg-warning' %>" 
                 role="progressbar" 
                 style="width: <%= percentage %>%"
                 aria-valuenow="<%= evaluation.score %>" 
                 aria-valuemin="<%= score_min %>" 
                 aria-valuemax="<%= score_max %>">
              <%= evaluation.score %>/<%= score_max %>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <% if criteria_scores.any? %>
      <h6><i class="bi bi-bar-chart"></i> Criteria Breakdown</h6>
      <div class="table-responsive mb-3">
        <table class="table table-sm table-bordered">
          <thead class="table-light">
            <tr>
              <th>Criterion</th>
              <th class="text-end" style="width: 150px;">Score</th>
              <th style="width: 200px;">Rating</th>
            </tr>
          </thead>
          <tbody>
            <% criteria_scores.each do |criterion, score| %>
              <% score_percentage = ((score - score_min) / (score_max - score_min) * 100).round %>
              <tr>
                <td><strong><%= criterion.to_s.humanize %></strong></td>
                <td class="text-end">
                  <span class="badge bg-primary"><%= score %>/<%= score_max %></span>
                </td>
                <td>
                  <div class="progress" style="height: 20px;">
                    <div class="progress-bar" 
                         role="progressbar" 
                         style="width: <%= score_percentage %>%"
                         aria-valuenow="<%= score %>" 
                         aria-valuemin="<%= score_min %>" 
                         aria-valuemax="<%= score_max %>">
                      <%= score_percentage %>%
                    </div>
                  </div>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    <% elsif criteria.any? %>
      <div class="alert alert-info">
        <strong>Evaluation Criteria:</strong> <%= criteria.join(', ') %>
      </div>
    <% end %>
    
    <% if evaluation.feedback.present? %>
      <h6><i class="bi bi-chat-left-text"></i> Judge Feedback</h6>
      <div class="alert alert-light border">
        <%= simple_format(evaluation.feedback) %>
      </div>
    <% end %>
    
    <% if metadata['judge_prompt'].present? %>
      <details class="mt-3">
        <summary class="btn btn-sm btn-outline-secondary">
          <i class="bi bi-code"></i> View Judge Prompt
        </summary>
        <div class="mt-2">
          <pre class="bg-light p-3 rounded" style="max-height: 300px; overflow-y: auto;"><code><%= metadata['judge_prompt'] %></code></pre>
        </div>
      </details>
    <% end %>
  </div>
</div>

