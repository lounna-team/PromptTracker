<td data-column="variables">
  <% if test.template_variables.present? && test.template_variables.any? %>
    <% variables_id = "test-variables-#{test.id}" %>
    <div class="expandable-text">
      <div id="<%= variables_id %>-truncated">
        <small class="text-muted">
          <%= test.template_variables.keys.first(2).map { |k| "#{k}: #{truncate(test.template_variables[k].to_s, length: 15)}" }.join(', ') %>
          <% if test.template_variables.keys.length > 2 %>
            ... (+<%= test.template_variables.keys.length - 2 %> more)
          <% end %>
        </small>
        <button class="btn btn-link btn-sm p-0 ms-1" type="button" onclick="document.getElementById('<%= variables_id %>-truncated').style.display='none'; document.getElementById('<%= variables_id %>-full').style.display='block';">
          <i class="bi bi-chevron-down"></i>
        </button>
      </div>
      <div id="<%= variables_id %>-full" style="display: none;">
        <% test.template_variables.each do |key, value| %>
          <div class="mb-1">
            <small><code class="text-primary">{{<%= key %>}}</code> = <code class="text-success">"<%= truncate(value.to_s, length: 40) %>"</code></small>
          </div>
        <% end %>
        <button class="btn btn-link btn-sm p-0 ms-1" type="button" onclick="document.getElementById('<%= variables_id %>-full').style.display='none'; document.getElementById('<%= variables_id %>-truncated').style.display='block';">
          <i class="bi bi-chevron-up"></i>
        </button>
      </div>
    </div>
  <% else %>
    <span class="text-muted">-</span>
  <% end %>
</td>
