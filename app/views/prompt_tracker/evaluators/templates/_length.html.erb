<div class="card mb-4">
  <div class="card-header <%= evaluation.passed? ? 'bg-success' : 'bg-danger' %> text-white">
    <h5 class="mb-0">
      <i class="bi bi-rulers"></i> 
      Length Validation: 
      <% if evaluation.passed? %>
        <span class="badge bg-light text-success">PASSED</span>
      <% else %>
        <span class="badge bg-light text-danger">FAILED</span>
      <% end %>
    </h5>
  </div>
  <div class="card-body">
    <% metadata = evaluation.metadata || {} %>
    <% response_length = metadata['response_length'] || 0 %>
    <% min_length = metadata['min_length'] || 0 %>
    <% max_length = metadata['max_length'] || 0 %>
    <% ideal_min = metadata['ideal_min'] || 0 %>
    <% ideal_max = metadata['ideal_max'] || 0 %>
    
    <div class="row mb-3">
      <div class="col-md-12">
        <h6><i class="bi bi-bar-chart"></i> Length Analysis</h6>
        <div class="d-flex align-items-center mb-2">
          <span class="me-2" style="width: 120px;"><strong>Actual Length:</strong></span>
          <span class="badge bg-primary fs-6"><%= response_length %> characters</span>
        </div>
        
        <div class="position-relative mt-3" style="height: 60px;">
          <!-- Background bar showing full range -->
          <div class="position-absolute w-100 bg-light rounded" style="height: 30px; top: 15px;"></div>
          
          <!-- Ideal range (green) -->
          <% ideal_start_pct = ((ideal_min - min_length).to_f / (max_length - min_length) * 100).round(2) %>
          <% ideal_width_pct = ((ideal_max - ideal_min).to_f / (max_length - min_length) * 100).round(2) %>
          <div class="position-absolute bg-success rounded" 
               style="height: 30px; top: 15px; left: <%= ideal_start_pct %>%; width: <%= ideal_width_pct %>%; opacity: 0.3;">
          </div>
          
          <!-- Actual position marker -->
          <% actual_pct = ((response_length - min_length).to_f / (max_length - min_length) * 100).clamp(0, 100).round(2) %>
          <div class="position-absolute" style="left: <%= actual_pct %>%; top: 0;">
            <div class="text-center">
              <i class="bi bi-caret-down-fill text-primary" style="font-size: 1.5rem;"></i>
            </div>
          </div>
        </div>
        
        <div class="d-flex justify-content-between mt-2 small text-muted">
          <span>Min: <%= min_length %></span>
          <span>Ideal: <%= ideal_min %>-<%= ideal_max %></span>
          <span>Max: <%= max_length %></span>
        </div>
      </div>
    </div>
    
    <div class="table-responsive mb-3">
      <table class="table table-sm table-bordered">
        <thead class="table-light">
          <tr>
            <th>Metric</th>
            <th class="text-end">Value</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Actual Length</strong></td>
            <td class="text-end"><%= response_length %> chars</td>
          </tr>
          <tr>
            <td>Minimum Acceptable</td>
            <td class="text-end"><%= min_length %> chars</td>
          </tr>
          <tr>
            <td>Maximum Acceptable</td>
            <td class="text-end"><%= max_length %> chars</td>
          </tr>
          <tr class="table-success">
            <td>Ideal Range</td>
            <td class="text-end"><%= ideal_min %>-<%= ideal_max %> chars</td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <% if evaluation.feedback.present? %>
      <div class="alert <%= evaluation.passed? ? 'alert-success' : 'alert-warning' %> mb-0">
        <strong>Result:</strong> <%= evaluation.feedback %>
      </div>
    <% end %>
  </div>
</div>

