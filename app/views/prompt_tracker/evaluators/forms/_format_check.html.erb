<%# Form template for Format Validator %>

<div class="alert alert-info mb-3">
  <i class="bi bi-file-code"></i>
  <strong>Format Validator</strong>
  <p class="mb-0 mt-1">Validates that the response matches the expected format (JSON, Markdown, etc.).</p>
</div>

<!-- Hidden fields for evaluator type -->
<input type="hidden" name="evaluation[evaluator_type]" value="automated">
<input type="hidden" name="evaluation[evaluator_id]" value="format_check">

<!-- Configuration Inputs -->
<div class="mb-3">
  <label class="form-label">Expected Format</label>
  <select name="format_check[expected_format]" class="form-select" id="expected_format_select">
    <option value="json">JSON</option>
    <option value="markdown">Markdown</option>
    <option value="plain">Plain Text</option>
    <option value="html">HTML</option>
    <option value="xml">XML</option>
  </select>
  <small class="form-text text-muted">
    The format that the response should be in.
  </small>
</div>

<!-- Schema Validation (for JSON) -->
<div class="mb-3" id="schema_validation_section">
  <label class="form-label">Schema Validation (Optional)</label>
  <textarea name="format_check[schema]"
            class="form-control font-monospace"
            rows="10"
            id="schema_input"
            placeholder='Example for JSON:
{
  "required_keys": ["status", "data", "message"],
  "optional_keys": ["metadata", "timestamp"],
  "nested_structure": {
    "data": {
      "required_keys": ["id", "name"],
      "types": {
        "id": "integer",
        "name": "string"
      }
    }
  },
  "types": {
    "status": "string",
    "message": "string"
  }
}'></textarea>
  <small class="form-text text-muted">
    <strong>For JSON format:</strong> Define the expected schema with required keys, optional keys, and types.
    <br>
    <strong>Supported types:</strong> string, integer, float, boolean, array, object, null
    <br>
    Leave empty to only validate JSON syntax without checking structure.
  </small>
</div>

<div class="mb-3">
  <div class="form-check">
    <input type="checkbox"
           name="format_check[strict]"
           class="form-check-input"
           id="strict_mode"
           value="true">
    <label class="form-check-label" for="strict_mode">
      Strict Mode
    </label>
    <small class="form-text text-muted d-block">
      If checked, the validator will be more strict about format compliance.
      For JSON with schema, this means no extra keys are allowed beyond required and optional keys.
    </small>
  </div>
</div>

<script>
  // Show/hide schema validation based on format selection
  document.addEventListener('DOMContentLoaded', function() {
    const formatSelect = document.getElementById('expected_format_select');
    const schemaSection = document.getElementById('schema_validation_section');

    function toggleSchemaSection() {
      if (formatSelect && schemaSection) {
        if (formatSelect.value === 'json') {
          schemaSection.style.display = 'block';
        } else {
          schemaSection.style.display = 'none';
        }
      }
    }

    if (formatSelect) {
      formatSelect.addEventListener('change', toggleSchemaSection);
      toggleSchemaSection(); // Initial state
    }
  });
</script>

<div class="alert alert-secondary">
  <i class="bi bi-lightning-charge"></i>
  <strong>Automatic Scoring</strong>
  <p class="mb-0">
    The evaluator will automatically score based on format compliance:
  </p>
  <ul class="mb-0 mt-2">
    <li><strong>JSON:</strong> Checks if the response is valid JSON</li>
    <li><strong>Markdown:</strong> Checks for proper Markdown structure</li>
    <li><strong>Plain Text:</strong> Checks that there are no special formatting characters</li>
    <li><strong>HTML:</strong> Checks for valid HTML tags</li>
    <li><strong>XML:</strong> Checks for valid XML structure</li>
  </ul>
  <p class="mb-0 mt-2">
    Score: 100% if format is valid, 0% if invalid.
  </p>
</div>
