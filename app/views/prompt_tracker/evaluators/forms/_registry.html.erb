<%# Form template for Registry Evaluators %>
<%# This form is for running configured or registry evaluators %>

<% 
  # Get evaluator metadata
  evaluator_key = params[:evaluator_key]
  metadata = PromptTracker::EvaluatorRegistry.get(evaluator_key.to_sym) if evaluator_key
%>

<% if metadata %>
  <div class="alert alert-info mb-3">
    <i class="bi bi-<%= metadata[:icon] || 'gear' %>"></i>
    <strong><%= metadata[:name] %></strong>
    <p class="mb-0 mt-1"><%= metadata[:description] %></p>
  </div>

  <!-- Hidden field for evaluator type -->
  <input type="hidden" name="evaluation[evaluator_type]" value="automated">
  <input type="hidden" name="evaluation[evaluator_id]" value="<%= evaluator_key %>">

  <div class="alert alert-warning">
    <i class="bi bi-info-circle"></i>
    <strong>Running Evaluator</strong>
    <p class="mb-0 mt-1">
      This will run the <strong><%= metadata[:name] %></strong> evaluator on this response.
      The evaluation will be created automatically with the results.
    </p>
  </div>

  <!-- Show configuration if available -->
  <% if metadata[:config_schema].present? %>
    <div class="mb-3">
      <h6>Configuration</h6>
      <div class="card">
        <div class="card-body">
          <% metadata[:config_schema].each do |key, schema| %>
            <div class="mb-2">
              <strong><%= key.to_s.humanize %>:</strong>
              <span class="text-muted"><%= schema[:description] %></span>
              <br>
              <small class="font-monospace">Default: <%= schema[:default].inspect %></small>
            </div>
          <% end %>
        </div>
      </div>
      <small class="form-text text-muted">
        This evaluator will run with its default configuration. To customize, add it as a configured evaluator on the prompt page.
      </small>
    </div>
  <% end %>

  <!-- Note about automatic scoring -->
  <div class="alert alert-secondary">
    <i class="bi bi-lightning-charge"></i>
    <strong>Automatic Scoring</strong>
    <p class="mb-0">
      When you submit this form, the evaluator will run automatically and generate a score.
      You don't need to enter a score manually.
    </p>
  </div>

<% else %>
  <div class="alert alert-danger">
    <i class="bi bi-exclamation-triangle"></i>
    <strong>Evaluator Not Found</strong>
    <p class="mb-0">The selected evaluator could not be found in the registry.</p>
  </div>
<% end %>

