<%# Form template for Human Evaluator %>
<%# This form is for manual human evaluation with score and feedback %>

<div class="alert alert-info mb-3">
  <i class="bi bi-person-circle"></i>
  <strong>Human Evaluation</strong>
  <p class="mb-0 mt-1">Manual review and rating by a person. Provide your assessment of the response quality.</p>
</div>

<!-- Hidden field for evaluator type -->
<input type="hidden" name="evaluation[evaluator_type]" value="human">

<div class="row">
  <!-- Evaluator ID (Email) -->
  <div class="col-md-12 mb-3">
    <label for="evaluation_evaluator_id" class="form-label">Your Email</label>
    <input type="text"
           name="evaluation[evaluator_id]"
           id="evaluation_evaluator_id"
           class="form-control"
           placeholder="e.g., john@example.com"
           required>
    <small class="form-text text-muted">Email address of the person performing this evaluation</small>
  </div>
</div>

<div class="row">
  <!-- Score -->
  <div class="col-md-4 mb-3">
    <label for="human_score" class="form-label">Score</label>
    <input type="number"
           name="evaluation[score]"
           id="human_score"
           class="form-control"
           step="0.1"
           min="0"
           max="5"
           value="3"
           required>
  </div>

  <!-- Score Min -->
  <div class="col-md-4 mb-3">
    <label for="human_score_min" class="form-label">Min Score</label>
    <input type="number"
           name="evaluation[score_min]"
           id="human_score_min"
           class="form-control"
           step="0.1"
           value="0"
           required>
  </div>

  <!-- Score Max -->
  <div class="col-md-4 mb-3">
    <label for="human_score_max" class="form-label">Max Score</label>
    <input type="number"
           name="evaluation[score_max]"
           id="human_score_max"
           class="form-control"
           step="0.1"
           value="5"
           required>
  </div>
</div>

<!-- Score Range Display -->
<div class="mb-3">
  <div class="d-flex justify-content-between align-items-center">
    <small class="text-muted">Score Range:</small>
    <input type="range" class="form-range" id="human_score_range" min="0" max="5" step="0.1" value="3">
    <span class="badge bg-primary ms-2" id="human_score_display">3.0</span>
  </div>
</div>

<!-- Feedback -->
<div class="mb-3">
  <label for="evaluation_feedback" class="form-label">Feedback</label>
  <textarea name="evaluation[feedback]"
            id="evaluation_feedback"
            class="form-control"
            rows="4"
            placeholder="Provide detailed feedback about this response..."
            required></textarea>
  <small class="form-text text-muted">Your comments and observations about the quality of this response</small>
</div>

<script>
  // Sync the range slider with the score input field for human evaluation
  (function() {
    const scoreInput = document.getElementById('human_score');
    const scoreRange = document.getElementById('human_score_range');
    const scoreDisplay = document.getElementById('human_score_display');
    const scoreMin = document.getElementById('human_score_min');
    const scoreMax = document.getElementById('human_score_max');

    function updateRange() {
      if (scoreMin && scoreMax && scoreRange) {
        scoreRange.min = scoreMin.value;
        scoreRange.max = scoreMax.value;
        scoreRange.value = scoreInput.value;
      }
    }

    function updateScore(value) {
      scoreInput.value = value;
      scoreDisplay.textContent = parseFloat(value).toFixed(1);
    }

    if (scoreRange && scoreInput && scoreDisplay) {
      // Update score when range slider changes
      scoreRange.addEventListener('input', function() {
        updateScore(this.value);
      });

      // Update range when score input changes
      scoreInput.addEventListener('input', function() {
        scoreRange.value = this.value;
        scoreDisplay.textContent = parseFloat(this.value).toFixed(1);
      });

      // Update range limits when min/max changes
      if (scoreMin) {
        scoreMin.addEventListener('input', updateRange);
      }
      if (scoreMax) {
        scoreMax.addEventListener('input', updateRange);
      }

      // Initialize
      updateRange();
      scoreDisplay.textContent = parseFloat(scoreInput.value).toFixed(1);
    }
  })();
</script>
