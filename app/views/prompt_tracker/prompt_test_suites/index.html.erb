<% content_for :breadcrumbs do %>
  <li class="breadcrumb-item active">Test Suites</li>
<% end %>

<div class="row mb-4">
  <div class="col">
    <h1>
      <i class="bi bi-collection"></i> Test Suites
    </h1>
    <p class="text-muted">Organize and run groups of tests together</p>
  </div>
  <div class="col-auto">
    <%= link_to new_prompt_test_suite_path, class: "btn btn-primary" do %>
      <i class="bi bi-plus-circle"></i> New Test Suite
    <% end %>
  </div>
</div>

<!-- Suite Stats -->
<div class="row mb-4">
  <div class="col-md-4">
    <div class="card metric-card">
      <div class="metric-value"><%= @suites.count %></div>
      <div class="metric-label">Total Suites</div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card metric-card">
      <div class="metric-value"><%= @suites.enabled.count %></div>
      <div class="metric-label">Enabled</div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card metric-card">
      <div class="metric-value">
        <% passing = @suites.select(&:passing?).count %>
        <%= passing %>/<%= @suites.count %>
      </div>
      <div class="metric-label">Passing</div>
    </div>
  </div>
</div>

<!-- Suites List -->
<div class="card">
  <div class="card-header">
    <h5 class="mb-0">All Test Suites</h5>
  </div>
  <div class="card-body">
    <% if @suites.any? %>
      <div class="table-responsive">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>Name</th>
              <th>Prompt</th>
              <th>Status</th>
              <th class="text-end">Tests</th>
              <th class="text-end">Pass Rate</th>
              <th>Last Run</th>
              <th>Tags</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% @suites.each do |suite| %>
              <tr>
                <td>
                  <strong><%= suite.name %></strong>
                  <% unless suite.enabled? %>
                    <span class="badge bg-secondary ms-2">Disabled</span>
                  <% end %>
                  <% if suite.description.present? %>
                    <br><small class="text-muted"><%= truncate(suite.description, length: 80) %></small>
                  <% end %>
                </td>
                <td>
                  <% if suite.prompt %>
                    <%= link_to suite.prompt.name, prompt_path(suite.prompt) %>
                  <% else %>
                    <span class="text-muted">All Prompts</span>
                  <% end %>
                </td>
                <td>
                  <% if suite.last_run %>
                    <% if suite.passing? %>
                      <span class="badge bg-success">Passing</span>
                    <% else %>
                      <span class="badge bg-danger">Failing</span>
                    <% end %>
                  <% else %>
                    <span class="badge bg-secondary">Not Run</span>
                  <% end %>
                </td>
                <td class="text-end">
                  <%= suite.enabled_tests.count %>
                </td>
                <td class="text-end">
                  <%= number_to_percentage(suite.pass_rate, precision: 0) %>
                </td>
                <td>
                  <% if suite.last_run %>
                    <%= time_ago_in_words(suite.last_run.created_at) %> ago
                  <% else %>
                    <span class="text-muted">Never</span>
                  <% end %>
                </td>
                <td>
                  <% suite.tags.each do |tag| %>
                    <span class="badge bg-info"><%= tag %></span>
                  <% end %>
                </td>
                <td>
                  <%= link_to "View", prompt_test_suite_path(suite), class: "btn btn-sm btn-outline-primary" %>
                  <%= link_to "Edit", edit_prompt_test_suite_path(suite), class: "btn btn-sm btn-outline-secondary" %>
                  <%= link_to "Run", run_prompt_test_suite_path(suite), method: :post, class: "btn btn-sm btn-outline-success" %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    <% else %>
      <div class="text-center py-5">
        <i class="bi bi-collection" style="font-size: 4rem; color: #ccc;"></i>
        <p class="text-muted mt-3">No test suites yet. Create your first suite to get started!</p>
        <%= link_to new_prompt_test_suite_path, class: "btn btn-primary" do %>
          <i class="bi bi-plus-circle"></i> Create First Suite
        <% end %>
      </div>
    <% end %>
  </div>
</div>

